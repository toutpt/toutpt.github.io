---
layout: post
title: A first gauge in react & svg responsive
categories: en
tags: react svg dataviz
published: false
---

I had the chance to work on a simple dataviz for Talend. The idea was to create a small app to explain what is the trust score.

The request feature is:

- responsive
- counter from 0 to 100
- gradient with 4 colors (0-25 25-50 50-75 75-100)
- circular but not fully circular (like a car gauge)

{% include image.html url="/assets/imgs/blog/2020/trustscore.png" description="Trust score by talend." width="250px" %}

## What already exists

As always when you start a new topic you search if it's already exists:

- [react-svg-gauge](https://www.npmjs.com/package/react-svg-gauge) provide a good example but it is not responsive and do not provide the wanted gradient.
- [Creating gauge in react](https://wattenberger.com/blog/gauge) is a great blog post bug it has only one gradient
- [Building a radial gauge with SVG and React](https://veerasundar.com/blog/2017/06/building-a-radial-gauge-with-svg-and-react-part-1/) great blog post too

So nothing fulfill exactly the needs but we have some good examples

## Let's build it

We have the following parts to cover:

- the gauge itself
- the value
- the gradient
- the animation

## SVG: The gauge itself

Let's start with a simple component:

```javascript
import React from "react";

export default function Gauge(props) {
  return (
    <div>
      <svg className="Gauge__container" viewBox="0 0 360 360">
        The Gauge should goes here
        <text x="90" y="190" fontFamily="Gelasio">
          {props.value}
        </text>
      </svg>
    </div>
  );
}
```

So now we need to know how to draw the main arc. I must say I didn't find an other way than using [d3-shape's arc](https://github.com/d3/d3-shape#arcs).

```javascript

import { arc } from 'd3-shape';
const arcGen = arc();

const size = 360;
const scale = (size * 2.5) / 200;
const INNER_RADIUS = 31;
const OUTER_RADIUS = 35;

const translate = `translate(${size / 2},${size / 2}) scale(${scale} ${scale})`;

// ...
    <svg className="Gauge__container" viewBox="0 0 360 360">
        <path
            fill="#ddd"
            d={arcGen({
                innerRadius: INNER_RADIUS,
                outerRadius: OUTER_RADIUS,
                startAngle: Math.PI,
                endAngle: 2.5*Math.PI,
            })}
        />
    </svg>
```

So angles are where you want to start and finish. 0 is 12 oclock, and Math.PI is 6 oclock.

{% include codepen.html url="https://codepen.io/toutpt/pen/VwaYdNR" height="300" %}

## SVG: The value

## SVG: The gradient

Conical gradient doesn't exist in svg we will have to fake them.

Resources:

- [Article on gradient-path](https://medium.com/@cereallarceny/getting-gradients-to-follow-along-svg-paths-in-javascript-45357b60bed7). Unfortunatly it did'nt work with transformation and opened.
- [Stackoverflow: How to draw linear gradient circle](https://stackoverflow.com/questions/30147879/how-to-draw-a-linear-gradient-circle-by-svg) and this one is the one !

Basicly both has the same approche: cut into multiple path to apply different gradient. Our cut will be:

- The current arc (where the value is)
- The last arc (gray)
- Optional the first arc if value > maxvalue/3
- Optional the second arc if value > 2\*maxvalue/3
- Optional the third arc if value === maxvalue

So the gradient look like this:

```javascript
<defs>
  <linearGradient
    id="first"
    gradientUnits="objectBoundingBox"
    x1="1"
    y1="1"
    x2="0"
    y2="0"
  >
    <stop offset="0%" stopColor={CHESTNUT_ROSE} />
    <stop offset="100%" stopColor={JAFFA} />
  </linearGradient>
  <linearGradient
    id="second"
    gradientUnits="objectBoundingBox"
    x1="0"
    y1="1"
    x2="1"
    y2="0"
  >
    <stop offset="0%" stopColor={JAFFA} />
    <stop offset="100%" stopColor={LIGHTING_YELLOW} />
  </linearGradient>
  <linearGradient
    id="last"
    gradientUnits="objectBoundingBox"
    x1="0"
    y1="0"
    x2="1"
    y2="1"
  >
    <stop offset="0%" stopColor={LIGHTING_YELLOW} />
    <stop offset="100%" stopColor={RIO_GRANDE} />
  </linearGradient>
</defs>
```

And now we need a bit more code

## The animation
